# Concord Smart Office - Development Overrides
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
#
# For local development without Docker:
#   cd backend && npm run dev
#   cd pwa && npm run dev

services:
  nginx:
    # In dev, you might run PWA directly with Vite for hot reload
    # This nginx is optional - use --profile nginx to include it
    profiles:
      - nginx
    ports:
      - "8080:80"  # Use 8080 to avoid conflict with local services

  backend:
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
    restart: "no"

  homeassistant:
    ports:
      - "8123:8123"
    restart: "no"

  # PWA dev server with hot reload
  pwa-dev:
    build:
      context: ../pwa
      dockerfile: Dockerfile.dev
    container_name: concord-pwa-dev
    ports:
      - "5173:5173"
    environment:
      - VITE_BACKEND_URL=http://localhost:3001
    volumes:
      - ../pwa/src:/app/src
      - ../pwa/public:/app/public
      - ../pwa/index.html:/app/index.html
    profiles:
      - pwa

  # Mock MQTT broker for testing (optional)
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: concord-mqtt-dev
    ports:
      - "1883:1883"
    profiles:
      - mqtt
